<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="static/chatbot-style.css">

    <title>Chatbot</title>
</head>
<body style="background-image: url(static/img/bg.jpg);">
    <div class="banner-area">
        <header>
            <h1><a href="{{ url_for('index') }}" class="logo">JakapatSteakHouse</a></h1>
            <ul class="menu">
                <h2><a href="{{url_for('index')}}" >Home</a></h2>

                <h2><a href="{{url_for('check')}}" >Main</a></h2>

                <h2><a href="{{url_for('chatbot')}}" >Chatbot</a></h2>

                <h2><a href="{{url_for('team')}}" >Team</a></h2>


            </ul>
        </header>
        </ul>    

    <button id="open-chat">ðŸ’¬</button>
    <button id="close-chat">âœ–</button>
    
    <div id="chatbox-popup">
        <div id="chatbox"></div>
        <div id="input-container">
            <input id="input" type="text" placeholder="Type your message...">
        </div>
    </div>

    <script>
        const chatboxPopup = document.getElementById('chatbox-popup');
        const openChatButton = document.getElementById('open-chat');
        const closeChatButton = document.getElementById('close-chat');
        const chatbox = document.getElementById('chatbox');
        const input = document.getElementById('input');

        openChatButton.addEventListener('click', () => {
            chatboxPopup.style.display = 'flex';
            openChatButton.style.display = 'none';
            closeChatButton.style.display = 'block';
        });

        closeChatButton.addEventListener('click', () => {
            chatboxPopup.style.display = 'none';
            openChatButton.style.display = 'block';
            closeChatButton.style.display = 'none';
        });

        input.addEventListener('keypress', async (e) => {
            if (e.key === 'Enter') {
                const message = input.value.trim();
                if (message) {
                    chatbox.innerHTML += `<div class="message user-message">${message}</div>`;
                    input.value = '';
                    
                    const response = await fetch('/webhook', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ message })
                    });
                    const botMessages = await response.json();
                    botMessages.forEach(msg => {
                        if (msg.text) {
                            chatbox.innerHTML += `<div class="message bot-message">${msg.text}</div>`;
                        }
                        if (msg.image) {
                            chatbox.innerHTML += `<div class="message bot-message"><img src="${msg.image}" alt="Image"></div>`;
                        }
                    });
                    chatbox.scrollTop = chatbox.scrollHeight;
                }
            }
        });
    </script>
</body>
</html>
